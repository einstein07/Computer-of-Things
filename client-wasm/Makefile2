CC=em++
SOURCES=src/ComputerOfThings.cpp
EMLDFLAGS:= -s "EXPORTED_FUNCTIONS=['_process_work_packages', '_malloc', '_free']" \
	    -s "EXPORTED_RUNTIME_METHODS=['ccall', 'cwrap']"
OBJECTS=$(SOURCES:.cpp=.o)
ComputerOfThings.mjs: 
	em++ --no-entry src/*.cpp -o ComputerOfThings.mjs \
	-s ENVIRONMENT='web' \
	-s SINGLE_FILE=1 \
	-s WASM=1 \
	-s EXPORT_NAME='createModule' \
	-s USE_ES6_IMPORT_META=0 \
	-s EXPORTED_FUNCTIONS='["_process_work_packages", "_malloc", "_free"]' \
	-s EXPORTED_RUNTIME_METHODS='["ccall", "cwrap"]' 
